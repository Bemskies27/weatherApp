<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        #map {
            height: 300px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4 text-gray-800">

    <div class="bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl p-8 w-full max-w-xl transition-all duration-300">
        
        <!-- Header Section -->
        <div class="flex items-center justify-center mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
            </svg>
            <h1 class="text-3xl font-bold text-blue-600">Weather Dashboard</h1>
        </div>

        <!-- Search Form -->
        <form method="post" class="flex flex-col sm:flex-row gap-4 mb-6" id="weather-form">
            <input type="text" name="city" placeholder="Enter city (e.g., Lagos)" required
                class="flex-1 px-5 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow duration-300 shadow-sm">
            <button type="submit"
                class="px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                Get Weather
            </button>
        </form>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden flex justify-center items-center py-8">
            <div class="loader"></div>
        </div>

        <!-- Error Message -->
        {% if error %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <strong class="font-bold">Oops!</strong>
                <span class="block sm:inline">{{ error }}</span>
            </div>
        {% endif %}

        <!-- Weather Results -->
        {% if weather %}
            <div class="bg-blue-50 border border-blue-200 p-6 rounded-2xl shadow-inner">
                
                <!-- Main Weather Info -->
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h2 class="text-3xl font-bold text-blue-800">{{ weather.city }}</h2>
                        <p class="text-gray-500 mt-1">{{ weather.description }}</p>
                    </div>
                    <p class="text-5xl font-bold text-blue-600" id="temperature-display">{{ weather.temperature }}Â°C</p>
                </div>

                <hr class="my-4 border-blue-200">

                <!-- Detailed Weather Grid -->
                <div class="grid grid-cols-2 gap-4 text-lg">
                    <div class="flex items-center">
                        <span class="mr-2 text-blue-500">ðŸ’§</span> Humidity: <span class="ml-auto font-semibold">{{ weather.humidity }}%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="mr-2 text-blue-500">ðŸ’¨</span> Wind Speed: <span class="ml-auto font-semibold">{{ weather.wind }} m/s</span>
                    </div>
                </div>

                <!-- Map Section -->
                <div id="map" class="mt-6"></div>
            </div>
             <a href="{{ url_for('forecast', city=weather.city) }}">View 5-Day Forecast</a>
        {% endif %}
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


    {% if weather %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const lat = {{ weather.lat }};
            const lon = {{ weather.lon }};

            const map = L.map('map').setView([lat, lon], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            L.marker([lat, lon]).addTo(map)
                .bindPopup("<b>{{ weather.city }}</b><br>Current Weather")
                .openPopup();
        });
    </script>
    
    {% endif %}

    <script>
        // JavaScript for handling the loading spinner
        const form = document.getElementById('weather-form');
        const loadingDiv = document.getElementById('loading');
        
        form.addEventListener('submit', () => {
            loadingDiv.classList.remove('hidden');
        });
    </script>
    
</body>
</html>
